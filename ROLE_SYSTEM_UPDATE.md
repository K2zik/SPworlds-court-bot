# Обновленная система ролей с дифференцированной обработкой

## Обзор

Система ролей была обновлена для поддержки дифференцированной обработки админских ролей в зависимости от типа судебного дела (lawsuits vs lawsuitssp).

## Изменения в системе ролей

### 1. Разделение админских UUID по типам дел

#### Для дел lawsuits (СПм):
- `2c104d7ab88c48f1a9991f9b6a8495ce` - OsterMiner (только для lawsuits)
- `4e8f921b25b147f7b0269040baae6237` - Администратор для lawsuits
- `ab3dc134092f42cd8cad4ffa2f4ffc52` - Админ для lawsuits

#### Для дел lawsuitssp (СП):
- `4e8f921b25b147f7b0269040baae6237` - Администратор для lawsuitssp
- `ab3dc134092f42cd8cad4ffa2f4ffc52` - Президент для lawsuitssp

### 2. Исключения

**OsterMiner и Ostermine** больше не считаются админами для дел из `lawsuitssp.json`. Они имеют админские привилегии только для дел из `lawsuits.json`.

## Техническая реализация

### Обновленная функция calculate_risk_assessment

```python
async def calculate_risk_assessment(self, uuid: str, court_stats: Tuple, lawsuit_type: str = None) -> Dict:
```

#### Параметры:
- `uuid`: UUID игрока
- `court_stats`: Статистика судебных дел
- `lawsuit_type`: Тип дела ("lawsuits" или "lawsuitssp")

#### Логика определения админа:

1. **API-роли**: Проверяются роли из API `https://tph-api.del1t.me/get_roles`
2. **UUID-роли по типу дела**: 
   - Для `lawsuits`: проверяется `admin_uuids_lawsuits`
   - Для `lawsuitssp`: проверяется `admin_uuids_lawsuitssp`

### Автоматическое определение типа дела

Система автоматически определяет тип дела на основе поля `tag` в данных:
- `tag == 'СПм'` → `lawsuit_type = "lawsuits"`
- `tag == 'СП'` → `lawsuit_type = "lawsuitssp"`

## Преимущества новой системы

1. **Точность**: Админские привилегии применяются только к соответствующим типам дел
2. **Гибкость**: Разные игроки могут быть админами для разных типов дел
3. **Безопасность**: Исключение OsterMiner из lawsuitssp предотвращает неправильную оценку риска

## Примеры работы

### Пример 1: OsterMiner в делах lawsuits
- **Тип дела**: lawsuits (СПм)
- **UUID**: `2c104d7ab88c48f1a9991f9b6a8495ce`
- **Результат**: Получает админские привилегии

### Пример 2: OsterMiner в делах lawsuitssp
- **Тип дела**: lawsuitssp (СП)
- **UUID**: `2c104d7ab88c48f1a9991f9b6a8495ce`
- **Результат**: НЕ получает админские привилегии

### Пример 3: Президент в делах lawsuitssp
- **Тип дела**: lawsuitssp (СП)
- **UUID**: `ab3dc134092f42cd8cad4ffa2f4ffc52`
- **Результат**: Получает админские привилегии

## Совместимость

Система полностью обратно совместима:
- Если `lawsuit_type` не указан, используется старая логика
- API-роли продолжают работать для всех типов дел
- Существующие функции продолжают работать без изменений

## Обновленные функции

1. `calculate_risk_assessment()` - добавлен параметр `lawsuit_type`
2. `format_court_report()` - автоматическое определение типа дела
3. `cmd_risk_analysis()` - автоматическое определение типа дела

## Конфигурация

Админские UUID настраиваются в переменных:
- `admin_uuids_lawsuits` - для дел lawsuits
- `admin_uuids_lawsuitssp` - для дел lawsuitssp 