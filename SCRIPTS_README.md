# –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç–∞—Ä—ã—Ö –∏–º–µ–Ω –∏–≥—Ä–æ–∫–æ–≤

## –û–±–∑–æ—Ä

–ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤.

## üìÅ –§–∞–π–ª—ã

### `analyze_lawsuits_structure.py`
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª.

**–§—É–Ω–∫—Ü–∏–∏:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `lawsuits.json` –∏ `lawsuitssp.json`
- –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—è —Å UUID –∏ –∏–º–µ–Ω–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤

**–ó–∞–ø—É—Å–∫:**
```bash
python analyze_lawsuits_structure.py
```

**–í—ã–≤–æ–¥:**
```
=== –ù–ê–ô–î–ï–ù–ù–´–ï –ü–û–õ–Ø ===
–ü–æ–ª—è —Å UUID (5):
  plaintiff_uuid
  defendant_uuid
  player_uuid
  uuid

–ü–æ–ª—è —Å –∏–º–µ–Ω–∞–º–∏ (3):
  plaintiff_name
  defendant_name
  username

=== –ü–†–ò–ú–ï–†–´ –ó–ù–ê–ß–ï–ù–ò–ô ===
–ü—Ä–∏–º–µ—Ä—ã UUID (3):
  2c104d7ab88c48f1a9991f9b6a8495ce
  9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d

–ü—Ä–∏–º–µ—Ä—ã –∏–º–µ–Ω (10):
  PlayerName1
  PlayerName2
  OldPlayerName
```

### `parse_old_names.py`
–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–§—É–Ω–∫—Ü–∏–∏:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–æ–≤ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç UUID –∏ –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤
- –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —á–µ—Ä–µ–∑ API
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `player_names`

**–ó–∞–ø—É—Å–∫:**
```bash
python parse_old_names.py
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–æ–≤
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ UUID –∏ –∏–º–µ–Ω
4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω —á–µ—Ä–µ–∑ API
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
6. –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤

–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:

```bash
python analyze_lawsuits_structure.py
```

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç:
- –ü–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤
- –ù–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –£–≤–∏–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### 2. –ü–∞—Ä—Å–∏–Ω–≥ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç:

```bash
python parse_old_names.py
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `player_names` –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
- –ó–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ `lawsuits.json` –∏ `lawsuitssp.json`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö UUID –∏ –∏–º–µ–Ω –∏–≥—Ä–æ–∫–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω —á–µ—Ä–µ–∑ Crafty.gg –∏ Mojang API
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–º–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –í—ã–≤–æ–¥ –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `player_names`

```sql
CREATE TABLE player_names (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    uuid TEXT,                    -- UUID –∏–≥—Ä–æ–∫–∞ (–±–µ–∑ –¥–µ—Ñ–∏—Å–æ–≤)
    username TEXT,                -- –ò–º—è –∏–≥—Ä–æ–∫–∞
    is_current BOOLEAN DEFAULT 0, -- –¢–µ–∫—É—â–µ–µ –ª–∏ —ç—Ç–æ –∏–º—è
    first_seen TIMESTAMP,         -- –ö–æ–≥–¥–∞ –∏–º—è –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–æ—Å—å
    last_seen TIMESTAMP,          -- –ö–æ–≥–¥–∞ –∏–º—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å
    UNIQUE(uuid, username)        -- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—ã UUID-–∏–º—è
);
```

### –ò–Ω–¥–µ–∫—Å—ã

```sql
CREATE INDEX idx_player_names_uuid ON player_names(uuid);
CREATE INDEX idx_player_names_username ON player_names(username);
CREATE INDEX idx_player_names_is_current ON player_names(is_current);
```

## üîç –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ UUID –∏ –∏–º–µ–Ω

–°–∫—Ä–∏–ø—Ç –∏—â–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–ª—è—Ö:

**UUID –ø–æ–ª—è:**
- `uuid`
- `player_uuid`
- `plaintiff_uuid`
- `defendant_uuid`

**–ü–æ–ª—è —Å –∏–º–µ–Ω–∞–º–∏:**
- `username`
- `player_name`
- `plaintiff_name`
- `defendant_name`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–æ–≤:**
   - –ß–∏—Ç–∞–µ—Ç JSON —Ñ–∞–π–ª—ã
   - –ò—â–µ—Ç –ø–æ–ª—è —Å UUID –∏ –∏–º–µ–Ω–∞–º–∏
   - –°–æ–∑–¥–∞–µ—Ç –ø–∞—Ä—ã UUID-–∏–º—è

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω –∏ –∏—Å—Ç–æ—Ä–∏–∏:**
   - –ü—Ä–æ–±—É–µ—Ç Laby API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∏–º–µ–Ω–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏
   - Fallback –Ω–∞ Mojang API
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç UUID –¥–ª—è API

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ (–∏–∑ —Ñ–∞–π–ª–æ–≤ + –∏—Å—Ç–æ—Ä–∏—è)
   - –ü–æ–º–µ—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–º—è –∫–∞–∫ `is_current = 1`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `last_seen` –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–º–µ–Ω

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:

```
=== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: 1500
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö UUID: 800
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω: 1200
–¢–µ–∫—É—â–∏—Ö –∏–º–µ–Ω: 800

–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–º–µ–Ω:
  UUID 2c104d7ab88c48f1a9991f9b6a8495ce: 5 –∏–º–µ–Ω
  UUID 9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d: 3 –∏–º–µ–Ω–∏
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `parse_old_names.py`

```python
DB_PATH = 'court_bot.db'                    # –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
LAWSUITS_FILES = ['lawsuits.json', 'lawsuitssp.json']  # –§–∞–π–ª—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API

```python
timeout = aiohttp.ClientTimeout(total=30, connect=10)  # –¢–∞–π–º–∞—É—Ç –¥–ª—è API
connector = aiohttp.TCPConnector(limit=10, limit_per_host=5)  # –õ–∏–º–∏—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

### –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

```python
await asyncio.sleep(0.1)  # –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ API
```

## üêõ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞—é—Ç –ª–æ–≥–∏:
- `parse_old_names.log` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫

1. **–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω:**
   ```
   WARNING: –§–∞–π–ª lawsuits.json –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
   ```

2. **–û—à–∏–±–∫–∞ API:**
   ```
   DEBUG: –û—à–∏–±–∫–∞ Crafty.gg –¥–ª—è UUID xxx: timeout
   ```

3. **–û—à–∏–±–∫–∞ –ë–î:**
   ```
   ERROR: –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–µ–Ω –¥–ª—è UUID xxx: UNIQUE constraint failed
   ```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

```bash
# 1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
python analyze_lawsuits_structure.py

# 2. –ü–∞—Ä—Å–∏–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ë–î
python parse_old_names.py

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
sqlite3 court_bot.db "SELECT COUNT(*) FROM player_names;"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT COUNT(*) as total_records,
       COUNT(DISTINCT uuid) as unique_uuids,
       COUNT(DISTINCT username) as unique_names,
       COUNT(*) FILTER (WHERE is_current = 1) as current_names
FROM player_names;

-- –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–º–µ–Ω
SELECT uuid, COUNT(*) as name_count
FROM player_names
GROUP BY uuid
ORDER BY name_count DESC
LIMIT 10;

-- –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
SELECT * FROM player_names WHERE username LIKE '%PlayerName%';
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –°–∫—Ä–∏–ø—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—ã
2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `INSERT OR IGNORE` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–¢–µ–∫—É—â–∏–µ –∏–º–µ–Ω–∞:** –¢–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–º—è –Ω–∞ UUID –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `is_current = 1`
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
5. **Fallback:** –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤–æ–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∏–º—è

–≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ–ª–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ç–∞—Ä—ã–º –Ω–∏–∫–Ω–µ–π–º–∞–º. 